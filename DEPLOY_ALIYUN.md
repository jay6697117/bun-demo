# â˜ï¸ é˜¿é‡Œäº‘ ECS æœåŠ¡å™¨éƒ¨ç½²æŒ‡å— (Docker æ–¹å¼)

æœ¬æ–‡æ¡£ä¸“é—¨é’ˆå¯¹é˜¿é‡Œäº‘ ECS æœåŠ¡å™¨ï¼ŒæŒ‡å¯¼å¦‚ä½•éƒ¨ç½²å½“å‰çš„ Bun + React åº”ç”¨ã€‚

## 1. å‡†å¤‡å·¥ä½œ

### è´­ä¹°/å‡†å¤‡ ECS å®ä¾‹
*   **æ“ä½œç³»ç»Ÿæ¨è**ï¼šUbuntu 22.04 LTS æˆ– Alibaba Cloud Linux 3ã€‚
*   **å…¬ç½‘ IP**ï¼šç¡®ä¿å¯ä»¥åˆ†é…å…¬ç½‘ IPv4 åœ°å€ã€‚

### ğŸ”¥ å…³é”®æ­¥éª¤ï¼šé…ç½®å®‰å…¨ç»„ (Security Group)
é˜¿é‡Œäº‘ ECS é»˜è®¤ä¼šæ‹¦æˆªå¤§éƒ¨åˆ†å…¥ç«™æµé‡ã€‚ä½ **å¿…é¡»**æ‰‹åŠ¨å¼€æ”¾åº”ç”¨ç«¯å£ã€‚

1.  ç™»å½•é˜¿é‡Œäº‘æ§åˆ¶å° -> ECS å®ä¾‹ -> å®ä¾‹è¯¦æƒ…ã€‚
2.  ç‚¹å‡» **"å®‰å…¨ç»„"** -> **"é…ç½®è§„åˆ™"**ã€‚
3.  ç‚¹å‡» **"æ‰‹åŠ¨æ·»åŠ "**ï¼š
    *   **æˆæƒç­–ç•¥**ï¼šå…è®¸
    *   **ä¼˜å…ˆçº§**ï¼š1
    *   **åè®®ç±»å‹**ï¼šTCP
    *   **ç«¯å£èŒƒå›´**ï¼š`3000` (è¿™æ˜¯æˆ‘ä»¬ docker-compose é…ç½®çš„åº”ç”¨ç«¯å£)
    *   **æˆæƒå¯¹è±¡**ï¼š`0.0.0.0/0` (å…è®¸æ‰€æœ‰ IP è®¿é—®)
4.  ä¿å­˜è§„åˆ™ã€‚

## 2. ç¯å¢ƒå®‰è£…

ç™»å½•åˆ°ä½ çš„ ECS æœåŠ¡å™¨ï¼ˆä½¿ç”¨ Workbench æˆ– SSHï¼‰ã€‚

#### æ£€æŸ¥/å®‰è£… Docker

é˜¿é‡Œäº‘é•œåƒæºé€šå¸¸ä¸‹è½½ Docker å¾ˆå¿«ã€‚

**å¦‚æœä½¿ç”¨çš„æ˜¯ Alibaba Cloud Linux 3 / CentOS 7+**:
```bash
sudo yum install -y docker
sudo systemctl start docker
sudo systemctl enable docker
```

**å¦‚æœä½¿ç”¨çš„æ˜¯ Ubuntu**:
```bash
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh
sudo systemctl start docker
sudo systemctl enable docker
```

**å®‰è£… Docker Compose (æ–°ç‰ˆ Docker å·²è‡ªå¸¦)**:
```bash
# éªŒè¯æ˜¯å¦å·²å®‰è£…
docker compose version
```

## 3. ä¸Šä¼ é¡¹ç›®æ–‡ä»¶

ä½ éœ€è¦æŠŠé¡¹ç›®æ–‡ä»¶ä¼ åˆ° ECS ä¸Šã€‚

### æ–¹æ¡ˆ Aï¼šä½¿ç”¨æœ¬åœ°ç»ˆç«¯ SCP (æ¨è Mac/Linux ç”¨æˆ·)

åœ¨ä½ çš„**æœ¬åœ°é¡¹ç›®æ ¹ç›®å½•**ï¼ˆåŒ…å« `Dockerfile` çš„ç›®å½•ï¼‰æ‰§è¡Œï¼š

```bash
# æ›¿æ¢ä¸ºä½ çš„ ECS å…¬ç½‘ IP
export ECS_IP="ä½ çš„å…¬ç½‘IP"

# åˆ›å»ºç›®å½•
ssh root@$ECS_IP "mkdir -p /opt/bun-demo"

# ä¸Šä¼ æ–‡ä»¶ (åˆ©ç”¨ .dockerignore æ’é™¤ node_modules)
# æ³¨æ„ï¼šSCP é»˜è®¤ä¸è¯»å– .dockerignoreï¼Œæ‰€ä»¥å»ºè®®æ‰‹åŠ¨æŒ‡å®šæ–‡ä»¶æˆ–ä½¿ç”¨ rsync
# ç®€å•èµ·è§ï¼Œæ‹·è´æ‰€æœ‰æ–‡ä»¶ï¼ˆç¨ååœ¨æœåŠ¡å™¨æ„å»ºæ—¶ Docker ä¼šå¿½ç•¥ä¸å¿…è¦çš„æ–‡ä»¶ï¼‰
scp -r . root@$ECS_IP:/opt/bun-demo
```

### æ–¹æ¡ˆ Bï¼šä½¿ç”¨ Git (æœ€æ¨è)

1.  æŠŠä½ çš„ä»£ç æ¨é€åˆ° GitHub/Gitee ç§æœ‰ä»“åº“ã€‚
2.  åœ¨ ECS ä¸Š `git clone` ä¸‹æ¥ã€‚

## 4. æ„å»ºä¸å¯åŠ¨

å›åˆ° **ECS æœåŠ¡å™¨ç»ˆç«¯**ï¼š

```bash
cd /opt/bun-demo

# ä½¿ç”¨ Docker Compose ä¸€é”®å¯åŠ¨
# --build: å¼ºåˆ¶æ„å»ºé•œåƒ
# -d: åå°è¿è¡Œ
sudo docker compose up -d --build
```

æ„å»ºè¿‡ç¨‹å¯èƒ½ä¼šèŠ±è´¹å‡ åˆ†é’Ÿï¼ˆå–å†³äºç½‘ç»œå’Œä¾èµ–ä¸‹è½½é€Ÿåº¦ï¼‰ã€‚

## 5. éªŒè¯è®¿é—®

æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®ï¼š
`http://<ä½ çš„ECSå…¬ç½‘IP>:3000`

å¦‚æœçœ‹åˆ° "æˆ‘çš„ä»»åŠ¡" (My Tasks) é¡µé¢ï¼Œè¯´æ˜éƒ¨ç½²æˆåŠŸï¼ğŸ‰

## 6. å¸¸ç”¨ç»´æŠ¤å‘½ä»¤

| æ“ä½œ | å‘½ä»¤ |
| :--- | :--- |
| **æŸ¥çœ‹æ—¥å¿—** | `docker compose logs -f` |
| **åœæ­¢æœåŠ¡** | `docker compose down` |
| **é‡å¯æœåŠ¡** | `docker compose restart` |
| **æ›´æ–°ä»£ç åé‡æ–°éƒ¨ç½²** | `git pull && docker compose up -d --build` |
